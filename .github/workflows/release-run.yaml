# =============================================================================
# üì¶ Execute Release Process
#
# Description:
#   Workflow that triggers the release execution process when release
#   preparation is complete and changes are pushed to the release branch.
#
# Features:
#   ‚Ä¢ Automatic trigger on release branch updates
#   ‚Ä¢ Configurable execution environment
#   ‚Ä¢ Release completion handling
#
# Trigger: push (branch: releases)
# Dependencies: reusable-release-execution.yaml
# =============================================================================

name: üì¶ Run Release

on:
  push:
    branches:
      - releases

jobs:
  metadata:
    name: Read Metadata & Trigger Reusable Release Workflow
    uses: stetind/ppc-reusable-workflows/.github/workflows/release-checkout.yaml@releases
    with:
      runner: ${{ vars.DEFAULT_RUNNER }}
      job_container: ${{ vars.DEFAULT_NODE_CONTAINER }}

  release:
    name: Create Release
    needs: metadata
    uses: stetind/ppc-reusable-workflows/.github/workflows/release-conventional.yaml@releases
    secrets: inherit
    with:
      tag: ${{ needs.metadata.outputs.new_tag }}
      prerelease: ${{ needs.metadata.outputs.prerelease }}
      release_notes: ${{ needs.metadata.outputs.release_notes }}
      release_notes_file: '.release_notes.md'
      runner: ${{ vars.DEFAULT_RUNNER }}
      job_container: ${{ vars.DEFAULT_NODE_CONTAINER }}

#  clean:
#    name: üßπ Merge and clean branches
#    needs: [ release, metadata ]
#    if: needs.metadata.outputs.source_branch !=  github.event.repository.default_branch
#    runs-on: ${{ vars.DEFAULT_RUNNER }}
#    container: ${{ vars.DEFAULT_NODE_CONTAINER }}
#    steps:
#      - name: ‚¨áÔ∏è Checkout repository
#        uses: actions/checkout@v4
#        with:
#          fetch-depth: 0
#          ref: ${{ needs.metadata.outputs.source_branch }}
#
#      - name: üîÑ Merge and Delete
#        id: create_pr
#        uses: stetind/ppc-github-composite-actions/.github/actions/create-pr-and-merge@v1.0.0
#        with:
#          token: ${{ secrets.WORKFLOW_TOKEN }}
#          title: Release ${{ needs.metadata.outputs.new_tag }}
#          merge_option: ${{ needs.metadata.outputs.merge_option }}
#          source: ${{ needs.metadata.outputs.source_branch }}
#          target: ${{ github.event.repository.default_branch }}
#
#  clean_release:
#    name: üßπ Clean Temporary branch
#    needs: [ release, metadata ]
#    runs-on: ${{ vars.DEFAULT_RUNNER }}
#    container: ${{ vars.DEFAULT_NODE_CONTAINER }}
#    steps:
#      - name: üóëÔ∏è Delete `releases` Branch
#        uses: stetind/ppc-github-composite-actions/.github/actions/delete-bracnh@v1.0.0
#        with:
#          token: ${{ secrets.WORKFLOW_TOKEN }}
#          branch: releases
