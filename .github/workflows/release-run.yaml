# =============================================================================
# ðŸ“¦ Execute Release Process
#
# Description:
#   Workflow that triggers the release execution process when release
#   preparation is complete and changes are pushed to the release branch.
#
# Features:
#   â€¢ Automatic trigger on release branch updates
#   â€¢ Configurable execution environment
#   â€¢ Release completion handling
#
# Trigger: push (branch: releases)
# Dependencies: reusable-release-execution.yaml
# =============================================================================

name: ðŸ“¦ Execute Release

on:
  push:
    branches:
      - releases

jobs:
  metadata:
    name: Read Metadata & Trigger Reusable Release Workflow
    uses: stetind/ppc-reusable-workflows/.github/workflows/release-chckout.yaml@releases
    with:
      runs-on: ${{ inputs.runner }}
      container: ${{ inputs.job_container }}

  release:
    name: ðŸ“Ÿ Final Release
    needs: metadata
    uses: stetind/ppc-reusable-workflows/.github/workflows/release-conventional.yaml@releases
    secrets: inherit
    with:
      tag: ${{ needs.metadata.outputs.previous_tag }}
      prerelease: ${{ needs.metadata.outputs.prerelease }}
      runner: ${{ inputs.runner }}
      job_container: ${{ inputs.job_container }}

  clean:
    name: ðŸ§¹ Merge and clean branches
    needs: [ release, metadata ]
    uses: stetind/ppc-reusable-workflows/.github/workflows/release-clean.yaml@releases
    secrets:
      GITHUB_TOKEN: ${{ secrets.WORKFLOW_TOKEN }}
    with:
      title: Release ${{ needs.metadata.outputs.new_tag }}
      merge_option: ${{ needs.metadata.outputs.merge_option }}
      source: ${{ needs.metadata.outputs.source_branch }}
      target: 'main'
