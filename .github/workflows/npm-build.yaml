name: Npm - Build

on:
  workflow_call:
    inputs:
      node_environemtn:
        description: Set the node environemtn (dev|production)
        type: string
        default: production
        required: true
      artifact_name:
        description: The artifact name, that contains the code which is being to be published
        type: string
        required: true

env:
  NODE_VERSION: 20

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      NODE_ENV: ${{ inputs.node_environemtn }}

    steps:
      - name: ğŸ›« Checkout
        uses: actions/checkout@v4

      - name: Setup Node and NPM
        uses: stetind/web-setup-node-npm-action@v1

      - name: ğŸ”§ Install Global Deployment Dependencies
        run: |
          npm install -g npm@10.5.0 &&
          npm install -g browserslist@4.23.0 &&
          npm install -g typescript@5.4.3 &&
          npm install -g envsub@4.1.0 &&
          npm install -g dotenv@16.3.1 &&
          npm install -g dotenv-cli@7.4.1 &&
          npm install -g ts-node@10.9.2

      - name: ğŸ Building Environment
        run: npm run build --if-present && npx browserslist@latest --update-db

      - name: âœ… Artifact creation
        if: ${{ success() }}
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.artifact_name }}
          retention-days: 1
          path: ${{github.workspace}}/*
